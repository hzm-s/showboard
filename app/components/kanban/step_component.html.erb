<% bg_color = 'bg-white' %>
<%= tag.div class: %w(flex-shrink-0), style: "flex-basis: #{width}rem" do %>
  <%= tag.div class: %W(relative pb-2 #{bg_color} border border-gray-200 rounded-lg drop-shadow-md), data: { controller: 'item-counter' } do %>
    <%= render Kanban::StepHeaderComponent.new(title: name, sub_titles: has_buffer? ? states.map(&:name) : []) do |c| %>
      <% c.with_counter { render Kanban::ItemCounterComponent.new(limit: limit) } %>
    <% end -%>

    <%= tag.div class: %w(h-full overflow-y-auto) do %>
      <%= tag.div style: "max-height:79vh" do %>

        <%= tag.div class: %w(px-2), style: "#{initial_step? && 'padding-bottom: 4rem;'}" do %>
          <% if has_buffer? %>
            <%= tag.div class: %w(flex flex-row justify-between) do %>
              <% states.each do |state| %>
                <%= render Kanban::StateComponent.new(state: state, work_flow: @work_flow) %>
              <% end -%>
            <% end -%>
          <% else -%>
            <% states.each do |state| %>
              <%= render Kanban::StateComponent.new(state: state, work_flow: @work_flow) %>
            <% end -%>
          <% end -%>
        <% end -%>

      <% end -%>
    <% end -%>

    <% if initial_step? %>
      <%= tag.div class: %W(block absolute bottom-0 w-full #{bg_color} rounded-lg p-2) do %>
        <%= tag.turbo_frame id: 'new_item_form' do %>
          <%= render Kanban::AddItemComponent.new %>
        <% end -%>
      <% end -%>
    <% end -%>
  <% end -%>
<% end -%>
